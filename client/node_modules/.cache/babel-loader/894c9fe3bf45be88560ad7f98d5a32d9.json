{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Adapter = void 0;\n\nconst events_1 = require(\"events\");\n\nclass Adapter extends events_1.EventEmitter {\n  /**\n   * In-memory adapter constructor.\n   *\n   * @param {Namespace} nsp\n   */\n  constructor(nsp) {\n    super();\n    this.nsp = nsp;\n    this.rooms = new Map();\n    this.sids = new Map();\n    this.encoder = nsp.server.encoder;\n  }\n  /**\n   * To be overridden\n   */\n\n\n  init() {}\n  /**\n   * To be overridden\n   */\n\n\n  close() {}\n  /**\n   * Adds a socket to a list of room.\n   *\n   * @param {SocketId}  id      the socket id\n   * @param {Set<Room>} rooms   a set of rooms\n   * @public\n   */\n\n\n  addAll(id, rooms) {\n    for (const room of rooms) {\n      if (!this.sids.has(id)) {\n        this.sids.set(id, new Set());\n      }\n\n      this.sids.get(id).add(room);\n\n      if (!this.rooms.has(room)) {\n        this.rooms.set(room, new Set());\n      }\n\n      this.rooms.get(room).add(id);\n    }\n  }\n  /**\n   * Removes a socket from a room.\n   *\n   * @param {SocketId} id     the socket id\n   * @param {Room}     room   the room name\n   */\n\n\n  del(id, room) {\n    if (this.sids.has(id)) {\n      this.sids.get(id).delete(room);\n    }\n\n    if (this.rooms.has(room)) {\n      this.rooms.get(room).delete(id);\n      if (this.rooms.get(room).size === 0) this.rooms.delete(room);\n    }\n  }\n  /**\n   * Removes a socket from all rooms it's joined.\n   *\n   * @param {SocketId} id   the socket id\n   */\n\n\n  delAll(id) {\n    if (!this.sids.has(id)) {\n      return;\n    }\n\n    for (const room of this.sids.get(id)) {\n      if (this.rooms.has(room)) {\n        this.rooms.get(room).delete(id);\n        if (this.rooms.get(room).size === 0) this.rooms.delete(room);\n      }\n    }\n\n    this.sids.delete(id);\n  }\n  /**\n   * Broadcasts a packet.\n   *\n   * Options:\n   *  - `flags` {Object} flags for this packet\n   *  - `except` {Array} sids that should be excluded\n   *  - `rooms` {Array} list of rooms to broadcast to\n   *\n   * @param {Object} packet   the packet object\n   * @param {Object} opts     the options\n   * @public\n   */\n\n\n  broadcast(packet, opts) {\n    const rooms = opts.rooms;\n    const except = opts.except || new Set();\n    const flags = opts.flags || {};\n    const packetOpts = {\n      preEncoded: true,\n      volatile: flags.volatile,\n      compress: flags.compress\n    };\n    const ids = new Set();\n    packet.nsp = this.nsp.name;\n    const encodedPackets = this.encoder.encode(packet);\n\n    if (rooms.size) {\n      for (const room of rooms) {\n        if (!this.rooms.has(room)) continue;\n\n        for (const id of this.rooms.get(room)) {\n          if (ids.has(id) || except.has(id)) continue;\n          const socket = this.nsp.sockets.get(id);\n\n          if (socket) {\n            socket.packet(encodedPackets, packetOpts);\n            ids.add(id);\n          }\n        }\n      }\n    } else {\n      for (const [id] of this.sids) {\n        if (except.has(id)) continue;\n        const socket = this.nsp.sockets.get(id);\n        if (socket) socket.packet(encodedPackets, packetOpts);\n      }\n    }\n  }\n  /**\n   * Gets a list of sockets by sid.\n   *\n   * @param {Set<Room>} rooms   the explicit set of rooms to check.\n   */\n\n\n  sockets(rooms) {\n    const sids = new Set();\n\n    if (rooms.size) {\n      for (const room of rooms) {\n        if (!this.rooms.has(room)) continue;\n\n        for (const id of this.rooms.get(room)) {\n          if (this.nsp.sockets.has(id)) {\n            sids.add(id);\n          }\n        }\n      }\n    } else {\n      for (const [id] of this.sids) {\n        if (this.nsp.sockets.has(id)) sids.add(id);\n      }\n    }\n\n    return Promise.resolve(sids);\n  }\n  /**\n   * Gets the list of rooms a given socket has joined.\n   *\n   * @param {SocketId} id   the socket id\n   */\n\n\n  socketRooms(id) {\n    return this.sids.get(id);\n  }\n\n}\n\nexports.Adapter = Adapter;","map":{"version":3,"sources":["/Users/paulinez/connect-four/node_modules/socket.io-adapter/dist/index.js"],"names":["Object","defineProperty","exports","value","Adapter","events_1","require","EventEmitter","constructor","nsp","rooms","Map","sids","encoder","server","init","close","addAll","id","room","has","set","Set","get","add","del","delete","size","delAll","broadcast","packet","opts","except","flags","packetOpts","preEncoded","volatile","compress","ids","name","encodedPackets","encode","socket","sockets","Promise","resolve","socketRooms"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Adapter = void 0;\nconst events_1 = require(\"events\");\nclass Adapter extends events_1.EventEmitter {\n    /**\n     * In-memory adapter constructor.\n     *\n     * @param {Namespace} nsp\n     */\n    constructor(nsp) {\n        super();\n        this.nsp = nsp;\n        this.rooms = new Map();\n        this.sids = new Map();\n        this.encoder = nsp.server.encoder;\n    }\n    /**\n     * To be overridden\n     */\n    init() { }\n    /**\n     * To be overridden\n     */\n    close() { }\n    /**\n     * Adds a socket to a list of room.\n     *\n     * @param {SocketId}  id      the socket id\n     * @param {Set<Room>} rooms   a set of rooms\n     * @public\n     */\n    addAll(id, rooms) {\n        for (const room of rooms) {\n            if (!this.sids.has(id)) {\n                this.sids.set(id, new Set());\n            }\n            this.sids.get(id).add(room);\n            if (!this.rooms.has(room)) {\n                this.rooms.set(room, new Set());\n            }\n            this.rooms.get(room).add(id);\n        }\n    }\n    /**\n     * Removes a socket from a room.\n     *\n     * @param {SocketId} id     the socket id\n     * @param {Room}     room   the room name\n     */\n    del(id, room) {\n        if (this.sids.has(id)) {\n            this.sids.get(id).delete(room);\n        }\n        if (this.rooms.has(room)) {\n            this.rooms.get(room).delete(id);\n            if (this.rooms.get(room).size === 0)\n                this.rooms.delete(room);\n        }\n    }\n    /**\n     * Removes a socket from all rooms it's joined.\n     *\n     * @param {SocketId} id   the socket id\n     */\n    delAll(id) {\n        if (!this.sids.has(id)) {\n            return;\n        }\n        for (const room of this.sids.get(id)) {\n            if (this.rooms.has(room)) {\n                this.rooms.get(room).delete(id);\n                if (this.rooms.get(room).size === 0)\n                    this.rooms.delete(room);\n            }\n        }\n        this.sids.delete(id);\n    }\n    /**\n     * Broadcasts a packet.\n     *\n     * Options:\n     *  - `flags` {Object} flags for this packet\n     *  - `except` {Array} sids that should be excluded\n     *  - `rooms` {Array} list of rooms to broadcast to\n     *\n     * @param {Object} packet   the packet object\n     * @param {Object} opts     the options\n     * @public\n     */\n    broadcast(packet, opts) {\n        const rooms = opts.rooms;\n        const except = opts.except || new Set();\n        const flags = opts.flags || {};\n        const packetOpts = {\n            preEncoded: true,\n            volatile: flags.volatile,\n            compress: flags.compress\n        };\n        const ids = new Set();\n        packet.nsp = this.nsp.name;\n        const encodedPackets = this.encoder.encode(packet);\n        if (rooms.size) {\n            for (const room of rooms) {\n                if (!this.rooms.has(room))\n                    continue;\n                for (const id of this.rooms.get(room)) {\n                    if (ids.has(id) || except.has(id))\n                        continue;\n                    const socket = this.nsp.sockets.get(id);\n                    if (socket) {\n                        socket.packet(encodedPackets, packetOpts);\n                        ids.add(id);\n                    }\n                }\n            }\n        }\n        else {\n            for (const [id] of this.sids) {\n                if (except.has(id))\n                    continue;\n                const socket = this.nsp.sockets.get(id);\n                if (socket)\n                    socket.packet(encodedPackets, packetOpts);\n            }\n        }\n    }\n    /**\n     * Gets a list of sockets by sid.\n     *\n     * @param {Set<Room>} rooms   the explicit set of rooms to check.\n     */\n    sockets(rooms) {\n        const sids = new Set();\n        if (rooms.size) {\n            for (const room of rooms) {\n                if (!this.rooms.has(room))\n                    continue;\n                for (const id of this.rooms.get(room)) {\n                    if (this.nsp.sockets.has(id)) {\n                        sids.add(id);\n                    }\n                }\n            }\n        }\n        else {\n            for (const [id] of this.sids) {\n                if (this.nsp.sockets.has(id))\n                    sids.add(id);\n            }\n        }\n        return Promise.resolve(sids);\n    }\n    /**\n     * Gets the list of rooms a given socket has joined.\n     *\n     * @param {SocketId} id   the socket id\n     */\n    socketRooms(id) {\n        return this.sids.get(id);\n    }\n}\nexports.Adapter = Adapter;\n"]},"metadata":{},"sourceType":"script"}